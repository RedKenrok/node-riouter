!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Rioter={})}(this,(function(t){"use strict";function e(t,e){void 0===e&&(e={});for(var r=function(t){for(var e=[],n=0;n<t.length;){var r=t[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)e.push({type:"CHAR",index:n,value:t[n++]});else{var i=1,s="";if("?"===t[u=n+1])throw new TypeError('Pattern cannot start with "?" at '+u);for(;u<t.length;)if("\\"!==t[u]){if(")"===t[u]){if(0==--i){u++;break}}else if("("===t[u]&&(i++,"?"!==t[u+1]))throw new TypeError("Capturing groups are not allowed at "+u);s+=t[u++]}else s+=t[u++]+t[u++];if(i)throw new TypeError("Unbalanced pattern at "+n);if(!s)throw new TypeError("Missing pattern at "+n);e.push({type:"PATTERN",index:n,value:s}),n=u}else{for(var o="",u=n+1;u<t.length;){var a=t.charCodeAt(u);if(!(a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122||95===a))break;o+=t[u++]}if(!o)throw new TypeError("Missing parameter name at "+n);e.push({type:"NAME",index:n,value:o}),n=u}else e.push({type:"CLOSE",index:n,value:t[n++]});else e.push({type:"OPEN",index:n,value:t[n++]});else e.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});else e.push({type:"MODIFIER",index:n,value:t[n++]})}return e.push({type:"END",index:n,value:""}),e}(t),i=e.prefixes,s=void 0===i?"./":i,o="[^"+n(e.delimiter||"/#?")+"]+?",u=[],a=0,h=0,l="",c=function(t){if(h<r.length&&r[h].type===t)return r[h++].value},p=function(t){var e=c(t);if(void 0!==e)return e;var n=r[h],i=n.type,s=n.index;throw new TypeError("Unexpected "+i+" at "+s+", expected "+t)},d=function(){for(var t,e="";t=c("CHAR")||c("ESCAPED_CHAR");)e+=t;return e};h<r.length;){var f=c("CHAR"),m=c("NAME"),v=c("PATTERN");if(m||v){var g=f||"";-1===s.indexOf(g)&&(l+=g,g=""),l&&(u.push(l),l=""),u.push({name:m||a++,prefix:g,suffix:"",pattern:v||o,modifier:c("MODIFIER")||""})}else{var y=f||c("ESCAPED_CHAR");if(y)l+=y;else if(l&&(u.push(l),l=""),c("OPEN")){g=d();var b=c("NAME")||"",w=c("PATTERN")||"",x=d();p("CLOSE"),u.push({name:b||(w?a++:""),pattern:b&&!w?o:w,prefix:g,suffix:x,modifier:c("MODIFIER")||""})}else p("END")}}return u}function n(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function r(t){return t&&t.sensitive?"":"i"}function i(t,i,s){return function(t,e,i){void 0===i&&(i={});for(var s=i.strict,o=void 0!==s&&s,u=i.start,a=void 0===u||u,h=i.end,l=void 0===h||h,c=i.encode,p=void 0===c?function(t){return t}:c,d="["+n(i.endsWith||"")+"]|$",f="["+n(i.delimiter||"/#?")+"]",m=a?"^":"",v=0,g=t;v<g.length;v++){var y=g[v];if("string"==typeof y)m+=n(p(y));else{var b=n(p(y.prefix)),w=n(p(y.suffix));if(y.pattern)if(e&&e.push(y),b||w)if("+"===y.modifier||"*"===y.modifier){var x="*"===y.modifier?"?":"";m+="(?:"+b+"((?:"+y.pattern+")(?:"+w+b+"(?:"+y.pattern+"))*)"+w+")"+x}else m+="(?:"+b+"("+y.pattern+")"+w+")"+y.modifier;else m+="("+y.pattern+")"+y.modifier;else m+="(?:"+b+w+")"+y.modifier}}if(l)o||(m+=f+"?"),m+=i.endsWith?"(?="+d+")":"$";else{var N=t[t.length-1],C="string"==typeof N?f.indexOf(N[N.length-1])>-1:void 0===N;o||(m+="(?:"+f+"(?="+d+"))?"),C||(m+="(?="+f+"|"+d+")")}return new RegExp(m,r(i))}(e(t,s),i,s)}function s(t,e,n){return t instanceof RegExp?function(t,e){if(!e)return t;for(var n=/\((?:\?<(.*?)>)?(?!\?)/g,r=0,i=n.exec(t.source);i;)e.push({name:i[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),i=n.exec(t.source);return t}(t,e):Array.isArray(t)?function(t,e,n){var i=t.map((function(t){return s(t,e,n).source}));return new RegExp("(?:"+i.join("|")+")",r(n))}(t,e,n):i(t,e,n)}class o{constructor(){this._events={}}destroy(){this._events=null}addListener(t,e){return Object.prototype.hasOwnProperty.call(this._events,t)?this._events[t].indexOf(e)<0&&this._events[t].push(e):this._events[t]=[e],!0}removeListener(t,e){if(!Object.prototype.hasOwnProperty.call(this._events,t))return;if(this._events[t].length<=0)return;const n=this._events[t].indexOf(e);n>=0&&this._events[t].splice(n,1)}removeAllListeners(t){Object.prototype.hasOwnProperty.call(this._events,t)&&delete this._events[t]}dispatch(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];Object.prototype.hasOwnProperty.call(this._events,t)&&(this._events[t].length<=0||this._events[t].forEach((t=>{t(...n)})))}}class u{static deepAssign(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];if(!n.length)return t;const i=n.shift();if(u.isObject(t)&&u.isObject(i))for(const e in i)u.isObject(i[e])?(t[e]||Object.assign(t,{[e]:{}}),u.deepAssign(t[e],i[e])):Object.assign(t,{[e]:i[e]});return u.deepAssign(t,...n)}static isObject(t){return t&&"object"==typeof t&&!Array.isArray(t)}}const a={sensitive:!1,strict:!1,end:!0,start:!0,delimiter:"/#?",encode:void 0,endsWith:void 0,prefixes:"./"};class h extends o{constructor(t,e){super(),this._options=u.deepAssign(a,e),this.path=t,this._regexp=s(this.path,[],this._options)}destroy(){this._regexp=null,this.path=null,this._options=null,super.destroy()}match(t){return this._regexp.test(t)}}class l extends o{constructor(t){void 0===t&&(t=null),super(),this._options=u.deepAssign({basePath:null,updateHistory:!1,pathToRegexp:a},t),this.pathCurrent=null,this.routeCurrent=null,this.routes=[]}destroy(){for(const t in this.routes)t.destroy();this._options=null,super.destroy()}createRoute(t,e){void 0===t&&(t=null),void 0===e&&(e=null);const n=new h(t,u.deepAssign(this._options.pathToRegexp,e));return this.routes.push(n),this.dispatch("create",{routes:this.routes,route:n}),n}push(t){if("string"!=typeof t)return!1;const e=t.replace(this._options.basePath,""),n=this.pathCurrent!==e;this.pathCurrent=e;let r=null;for(let t=0;t<this.routes.length;t++){const e=this.routes[t];e.match(this.pathCurrent)&&(r=e)}const i=this.routeCurrent!==r;if(this.routeCurrent=r,n){if(this._options.updateHistory&&"undefined"!=typeof window){const e=t.includes(this._options.basePath)?t:this._options.basePath+t;e!==window.history.location&&window.history.pushState(null,window.document.title,e)}this.dispatch("push",{router:this,route:this.routeCurrent,path:this.pathCurrent})}i&&this.routeCurrent&&this.routeCurrent.dispatch("push",{router:this,route:this.routeCurrent,path:this.pathCurrent})}}function c(t,e){t.firstChild&&(e.appendChild(t.firstChild),c(t,e))}function p(t){Array.from(t).forEach(d)}const d=t=>t&&t.parentNode&&t.parentNode.removeChild(t),f=(t,e)=>e&&e.parentNode&&e.parentNode.insertBefore(t,e),m=Symbol.for("pure"),v=Symbol("parent");var g=4;function y(t,e){return typeof t===e}function b(t){const e=t.ownerSVGElement;return!!e||null===e}function w(t){return!C(t.content)}function x(t){return y(t,"function")}function N(t){return!C(t)&&y(t,"object")}function C(t){return null==t}const E=Symbol("unmount"),O={nodes:[],mount(t,e){return this.update(t,e)},update(t,e){const{placeholder:n,nodes:r,childrenMap:i}=this,s=t===E?null:this.evaluate(t),o=s?Array.from(s):[],{newChildrenMap:u,batches:a,futureNodes:h}=(n.parentNode,function(t,e,n,r){const{condition:i,template:s,childrenMap:o,itemName:u,getKey:a,indexName:h,root:l,isTemplateTag:c}=r,p=new Map,d=[],f=[];return t.forEach(((t,r)=>{const m=function(t,{itemName:e,indexName:n,index:r,item:i}){t[e]=i,n&&(t[n]=r);return t}(Object.create(e),{itemName:u,indexName:h,index:r,item:t}),v=a?a(m):r,g=o.get(v);if(function(t,e){return!!t&&!1===Boolean(t(e))}(i,m))return;const y=g?g.template:s.clone(),b=g?y.el:l.cloneNode(),w=!g,x=c&&w?function(t){const e=t.dom.cloneNode(!0);return{avoidDOMInjection:!0,fragment:e,children:Array.from(e.childNodes)}}(y):{};if(w?d.push((()=>y.mount(b,m,n,x))):d.push((()=>y.update(m,n))),c){const t=x.children||y.children;f.push(...t)}else f.push(b);o.delete(v),p.set(v,{template:y,context:m,index:r})})),{newChildrenMap:p,batches:d,futureNodes:f}}(o,t,e,this));return((t,e,n,r,i)=>{const s=n.length;let o=e.length,u=s,a=0,h=0,l=null;for(;a<o||h<u;)if(o===a){const t=u<s?h?r(n[h-1],-0).nextSibling:r(n[u-h],0):i;for(;h<u;)f(r(n[h++],1),t)}else if(u===h)for(;a<o;)l&&l.has(e[a])||d(r(e[a],-1)),a++;else if(e[a]===n[h])a++,h++;else if(e[o-1]===n[u-1])o--,u--;else if(e[a]===n[u-1]&&n[h]===e[o-1]){const t=r(e[--o],-1).nextSibling;f(r(n[h++],1),r(e[a++],-1).nextSibling),f(r(n[--u],1),t),e[o]=n[u]}else{if(!l){l=new Map;let t=h;for(;t<u;)l.set(n[t],t++)}if(l.has(e[a])){const t=l.get(e[a]);if(h<t&&t<u){let i=a,s=1;for(;++i<o&&i<u&&l.get(e[i])===t+s;)s++;if(s>t-h){const i=r(e[a],0);for(;h<t;)f(r(n[h++],1),i)}else c=r(n[h++],1),(p=r(e[a++],-1))&&p.parentNode&&p.parentNode.replaceChild(c,p)}else a++}else d(r(e[a++],-1))}var c,p})(0,r,h,function(t,e){return(n,r)=>{if(r<0){const n=t.pop();if(n){const{template:t,context:r}=n;t.unmount(r,e,null)}}return n}}(Array.from(i.values()),e),n),a.forEach((t=>t())),this.childrenMap=u,this.nodes=h,this},unmount(t,e){return this.update(E,e),this}};const A={mount(t,e){return this.update(t,e)},update(t,e){const n=!!this.evaluate(t),r=!this.value&&n,i=this.value&&!n,s=()=>{const n=this.node.cloneNode();f(n,this.placeholder),this.template=this.template.clone(),this.template.mount(n,t,e)};switch(!0){case r:s();break;case i:this.unmount(t);break;default:n&&this.template.update(t,e)}return this.value=n,this},unmount(t,e){return this.template.unmount(t,e,!0),this}};const T="removeAttribute",M="setAttribute",_="undefined"==typeof Element?{}:Element.prototype,j=function(t){const e=new Map,n=n=>(e.has(n)||e.set(n,t.call(this,n)))&&e.get(n);return n.cache=e,n}((t=>_.hasOwnProperty(t)));function R(t,{name:e},n,r){if(!e)return r&&function(t,e,n){const r=e?Object.keys(e):[];Object.keys(n).filter((t=>!r.includes(t))).forEach((e=>t.removeAttribute(e)))}(t,n,r),void(n&&function(t,e){Object.entries(e).forEach((([e,n])=>R(t,{name:e},n)))}(t,n));!j(e)&&(function(t){return y(t,"boolean")}(n)||N(n)||x(n))&&(t[e]=n),t[function(t){return C(t)||!1===t||""===t||N(t)||x(t)?T:M}(n)](e,function(t,e){return!0===e?t:e}(e,n))}const P=/^on/,S={handleEvent(t){this[t.type](t)}},D=new WeakMap;function k(t){return C(t)?"":t}const H=(t,e)=>{const n=t.childNodes[e];if(n.nodeType===Node.COMMENT_NODE){const e=document.createTextNode("");return t.replaceChild(e,n),e}return n};var I={0:R,1:function(t,{name:e},n){const r=e.replace(P,""),i=D.get(t)||(t=>{const e=Object.create(S);return D.set(t,e),e})(t),[s,o]=(t=>Array.isArray(t)?t:[t,!1])(n),u=i[r],a=s&&!u;u&&!s&&t.removeEventListener(r,i),a&&t.addEventListener(r,i,o),i[r]=s},2:function(t,e,n){t.data=k(n)},3:function(t,e,n){t.value=k(n)}};const L={mount(t){return this.value=this.evaluate(t),F(this,this.value),this},update(t){const e=this.evaluate(t);return this.value!==e&&(F(this,e),this.value=e),this},unmount(){return 1===this.type&&F(this,null),this}};function F(t,e){return I[t.type](t.node,t,e,t.value)}const B=(t,e)=>t[v]||e,U={attributes:[],getTemplateScope(t,e){return function(t,e,n){if(!t||!t.length)return n;const r=t.map((t=>({...t,value:t.evaluate(e)})));return Object.assign(Object.create(n||null),function(t){return t.reduce(((t,e)=>{const{value:n,type:r}=e;switch(!0){case!e.name&&0===r:return{...t,...n};case 3===r:t.value=e.value;break;default:t[(i=e.name,i.replace(/-(\w)/g,((t,e)=>e.toUpperCase())))]=e.value}var i;return t}),{})}(r))}(this.attributes,t,e)},mount(t,e){const n=!!t.slots&&t.slots.find((({id:t})=>t===this.name)),{parentNode:r}=this.node,i=B(t,e);return this.template=n&&Q(n.html,n.bindings).createDOM(r),this.template&&(this.template.mount(this.node,this.getTemplateScope(t,i),i),this.template.children=Array.from(this.node.childNodes),$(this.node)),d(this.node),this},update(t,e){if(this.template){const n=B(t,e);this.template.update(this.getTemplateScope(t,n),n)}return this},unmount(t,e,n){return this.template&&this.template.unmount(this.getTemplateScope(t,e),null,n),this}};function $(t){const e=t&&t.firstChild;e&&(f(e,t),$(t))}function W(t){return t.reduce(((t,{bindings:e})=>t.concat(e)),[])}const K={mount(t){return this.update(t)},update(t,e){const n=this.evaluate(t);return n===this.name?this.tag.update(t):(this.unmount(t,e,!0),this.name=n,this.tag=function(t,e=[],n=[]){return t?t({slots:e,attributes:n}):Q(function(t){return t.reduce(((t,e)=>t+e.html),"")}(e),[...W(e),{expressions:n.map((t=>({type:0,...t})))}])}(this.getComponent(n),this.slots,this.attributes),this.tag.mount(this.node,t)),this},unmount(t,e,n){return this.tag&&this.tag.unmount(n),this}};var q={1:function(t,{evaluate:e,template:n}){const r=document.createTextNode("");return f(r,t),d(t),{...A,node:t,evaluate:e,placeholder:r,template:n.createDOM(t)}},2:function(t,{expressions:e}){return{...(n=e.map((e=>function(t,e){return{...L,...e,node:2===e.type?H(t,e.childNodeIndex):t}}(t,e))),r=["mount","update","unmount"],r.reduce(((t,e)=>({...t,[e]:t=>n.map((n=>n[e](t)))&&i})),{}))};var n,r,i},0:function(t,{evaluate:e,condition:n,itemName:r,indexName:i,getKey:s,template:o}){const u=document.createTextNode(""),a=t.cloneNode();return f(u,t),d(t),{...O,childrenMap:new Map,node:t,root:a,condition:n,evaluate:e,isTemplateTag:w(a),template:o.createDOM(t),getKey:s,indexName:i,itemName:r,placeholder:u}},3:function(t,{evaluate:e,getComponent:n,slots:r,attributes:i}){return{...K,node:t,evaluate:e,slots:r,attributes:i,getComponent:n}},4:function(t,{name:e,attributes:n}){return{...U,attributes:n,node:t,name:e}}};function z(t,e){return t.map((t=>2===t.type?{...t,childNodeIndex:t.childNodeIndex+e}:t))}function G(t,e){return b(t)?function(t,e){return e.ownerDocument.importNode((new window.DOMParser).parseFromString(`<svg xmlns="http://www.w3.org/2000/svg">${t}</svg>`,"application/xml").documentElement,!0)}(e,t):function(t,e){const n=w(e)?e:document.createElement("template");return n.innerHTML=t,n.content}(e,t)}function V(t,e){switch(!0){case b(t):c(e,t);break;case w(t):t.parentNode.replaceChild(e,t);break;default:t.appendChild(e)}}const J=Object.freeze({createDOM(t){return this.dom=this.dom||function(t,e){return e&&("string"==typeof e?G(t,e):e)}(t,this.html),this},mount(t,e,n,r={}){if(!t)throw new Error("Please provide DOM node to mount properly your template");this.el&&this.unmount(e);const{fragment:i,children:s,avoidDOMInjection:o}=r,{parentNode:u}=s?s[0]:t,a=w(t),h=a?Math.max(Array.from(u.childNodes).indexOf(t),0):null;return this.isTemplateTag=a,this.createDOM(t),this.dom&&(this.fragment=i||this.dom.cloneNode(!0)),this.el=this.isTemplateTag?u:t,this.children=this.isTemplateTag?s||Array.from(this.fragment.childNodes):null,!o&&this.fragment&&V(t,this.fragment),this.bindings=this.bindingsData.map((t=>function(t,e,n){const{selector:r,type:i,redundantAttribute:s,expressions:o}=e,u=r?t.querySelector(r):t;s&&u.removeAttribute(s);const a=o||[];return(q[i]||q[2])(u,{...e,expressions:n&&!r?z(a,n):a})}(this.el,t,h))),this.bindings.forEach((t=>t.mount(e,n))),this},update(t,e){return this.bindings.forEach((n=>n.update(t,e))),this},unmount(t,e,n){if(this.el){switch(this.bindings.forEach((r=>r.unmount(t,e,n))),!0){case this.el[m]:break;case this.children&&null!==n:p(this.children);break;case!0===n:d(this.el);break;case null!==n:p(this.el.childNodes)}this.el=null}return this},clone(){return{...this,el:null}}});function Q(t,e=[]){return{...J,html:t,bindingsData:e}}const X=function(t){return t[m]=!0,t},Y=Symbol("router");var Z={css:null,exports:X((({slots:t,attributes:e,props:n})=>{const r=t=>e&&e.find((e=>e.name===t));return{active:null,el:null,root:null,router:null,state:null,mount(e,n){if(!t||!t.length)return;this.active=!1,this.el=this.root=e,this.state={},this.slot=Q(null,[{type:g,name:"default"}]),this.router=n[Y].router;const r=this.root.getAttribute("path");if(!r)throw new Error("No path found for route component.");this.route=this.router.createRoute(r),this.handleRouteChange=({route:t})=>{const e=this.route===t;this.active!==e&&(this.active=e,this.update(n))},this.router.addListener("push",this.handleRouteChange)},update(e){if(this.active){const n=r("onBeforeMount");n&&n.evaluate(e)(this,this.route,this.router.pathCurrent);const i=document.createElement("div");this.root.appendChild(i),this.slot.mount(i,{slots:t},e);const s=r("onMounted");s&&s.evaluate(e)(this,this.route,this.router.pathCurrent)}else{const n=r("onBeforeUnmount");n&&n.evaluate(e)(this,this.route,this.router.pathCurrent),this.slot.unmount({slots:t},e,!0);const i=r("onUnmounted");i&&i.evaluate(e)(this,this.route,this.router.pathCurrent)}},unmount(...t){this.router.removeListener("push",this.handleRouteChange),this.slot.unmount(...t)}}})),template:null,name:"riouter-route"};const tt=window.requestAnimationFrame||window.setTimeout,et=window.cancelAnimationFrame||window.clearTimeout;var nt={css:null,exports:X((({slots:t,attributes:e,props:n})=>{const r=t=>e&&e.find((e=>e.name===t)),i=t=>{const e=r("base");return e?e.evaluate(t):window.location.protocol+"//"+window.location.host};return{deferred:null,el:null,root:null,router:null,slot:null,mount(e,n){if(!t||!t.length)return;this.el=this.root=e,this.state={};const s=r("updateHistory");this.router=new l({basePath:i(),updateHistory:s&&"false"!==s}),this.router.push(window.location.href),this.slot=Q(null,[{type:g,name:"default"}]),n[Y]=this;const o=r("onBeforeStart");o&&o.evaluate(n)(this,this.router,this.router.pathCurrent),this.slot.mount(this.root,{slots:t},n);const u=r("onStart");u&&u.evaluate(n)(this,this.router,this.router.pathCurrent)},update(t){this.slot&&(et(this.deferred),this.deferred=tt((()=>{this.slot.update({},this)})))},unmount(...t){this.slot&&this.slot.unmount(...t),this.root.remove(),this.router.destroy()}}})),template:null,name:"riouter-router"};const rt=h,it=l,st=Z,ot=nt;t.Route=rt,t.Router=it,t.route=st,t.router=ot,Object.defineProperty(t,"__esModule",{value:!0})}));
